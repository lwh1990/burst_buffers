# burst_buffers
Simulation of a burst buffer architecture for HPC systems using CODES/ROSS parallel discrete event simulator from Argonne National Lab
Required:First install ROSS, codes-base and codes-net.

Installing ROSS

NOTE: see bottom of this file for suggested configurations on particular ANL
machines.

0 - Checkout, build, and install the trunk version of ROSS
(https://github.com/carothersc/ROSS). At the time of
release (0.4.0), ROSS's latest commit hash was 44b7b9a, so this revision is
"safe" in the unlikely case incompatible changes come along in the future. If
working from the CODES master branches, use the ROSS master branch.

    git clone http://github.com/carothersc/ROSS.git
    # if using 0.4.0 release: git checkout 44b7b9a
    cd ROSS
    mkdir build
    cd build
	# note: other options for ARCH include i386 (for 32 bit machines),
	# bgp, and bgq (for Blue Gene systems)
    ARCH=x86_64 CC=mpicc CXX=mpicxx cmake -DCMAKE_INSTALL_PREFIX=../install ../
    make -j 3
    make install

    <the result should be that the latest version of ROSS is installed in the 
    ROSS/install/ directory>

    For more details on installing ROSS, go to
    https://github.com/carothersc/ROSS/blob/master/README.md .
    
Installing codes-base:

    If using ccmake to configure, don't forget to set CMAKE_C_COMPILER and
    CMAKE_CXX_COMPILER to mpicc/mpicxx

1 - If you are building codes-base directly from the repository, run

    ./prepare.sh

2 - Configure codes-base. This can be done in the source directory or in a
    dedicated build directory if you prefer out-of-tree builds.  The CC
    environment variable must refer to an MPI compiler.

    mkdir build
    cd build
    ../configure --prefix=/path/to/codes-base/install CC=mpicc PKG_CONFIG_PATH=/path/to/ross/install/lib/pkgconfig

    To enable network tracing with dumpi
    (http://sst.sandia.gov/about_dumpi.html), use the option
    --with-dumpi=/path/to/dumpi/install with configure.

    NOTE: we only require libundumpi for trace processing. Hence, if building
    dumpi from source you may configure with --disable-libdumpi and
    --enable-libundumpi (this is especially useful if you have mpich3, which
    breaks libdumpi's function wrappers through const'ifying the MPI
    interface).

    Use the --with-darshan argument to configure to enable the optional
    Darshan I/O workload generator
    (http://www.mcs.anl.gov/research/projects/darshan/).  In order to use
    this option, you must either have the darshan-util portion
    of Darshan installed in the default system path, or else add
    <DARSHAN_PREFIX>/lib/pkgconfig to your PKG_CONFIG_PATH environment
    variable before calling configure.
   
3 - Build and install codes-base

    make && make install

4 - (optional) run test programs

    make tests && make check

5 - codes-base uses flex and bison (or lex and yacc) to generate several
    parsers. These tools auto-generate C source files. To get around versioning
    issues, we've distributed the auto-generated sources directly. To remove
    all of the autogenerated files for these parsers, execute

    make maintainer-clean-local


Machine-specific configurations:
----------------
- Fusion (ANL): add the following keys to your ~/.soft file and run "resoft"
  prior to following the steps described in this file:

  +python-2.7.3
  +autoconf-2.68
  +git
  +cmake

Notes on using the clang static analyzer
-----------------
- follow steps 0-2 as shown above, with one exception:
  - add the following argument to configure:
    CFLAGS=-I<path_to_your_mpi_include_directory>
- edit Makefile, and delete the "CC = mpicc" (or similar) line
- run "scan-build --use-cc=mpicc make"

Notes on using uncrustify
-----------------
- version 0.61 is required
- build/install uncrustify from your favorite distro (0.61), OR download from
  https://github.com/bengardner/uncrustify and build from source
  (configure --prefix /path/to/install && make && make install)
- either use uncrustify directly (see uncrustify --help) or use the provided
  reformat.sh tool which is a shim over some of the options (see reformat.sh
  -h)

Installing codes-net:

0 - Install codes-base, either from the repository or using the 0.3.0 release
    tarball (see http://www.mcs.anl.gov/projects/codes/).

1 - If you are building codes-net directly from the repository, run

    ./prepare.sh

2 - Configure codes-net. This can be done in the source directory or in a
    dedicated build directory if you prefer out-of-tree builds.  The CC
    environment variable must refer to an MPI compiler.

    mkdir build
    cd build
    ../configure --prefix=/path/to/codes-net/install CC=mpicc PKG_CONFIG_PATH=/path/to/codes-base/install/lib/pkgconfig

3 - Build codes-net

    make && make install
4 - (optional) run test programs

    make tests && make check

Notes on using uncrustify
-----------------
- version 0.61 is required
- build/install uncrustify from your favorite distro (0.61), OR download from
  https://github.com/bengardner/uncrustify and build from source
  (configure --prefix /path/to/install && make && make install)
- either use uncrustify directly (see uncrustify --help) or use the provided
  reformat.sh tool which is a shim over some of the options (see reformat.sh
  -h)

Compile and run Burst Buffers simulator code:

Compile: make clean
make Burst_Buffers_new:

Run:
To run the code run run.sh with args NP-number of processors and SYNC-synchronization protocol. 
Currently works with only sequential execution, so always use SYNC=1.

./run.sh <NP> <SYNC>
Example: ./run.sh 1 1
